{% extends "base.html" %}

{% block script %}
<script type="text/javascript">
	var dt_vuln_list_table_options = {
		'ajax': {'url': "{{ url_for('storage.vuln_list_json_route') }}", 'method': 'POST'},
		'columns': [
			dt_column_select(),
			dt_column('id'),
			dt_column('host_id', {'visible': false}),
			dt_column('host_address', {'render': function (data, type, row, meta) { return storage_pagepart_host_link(row); }}),
			dt_column('host_hostname'),
			dt_column('service'),
			dt_column('name', {'render': function (data, type, row, meta) { return storage_pagepart_vuln_link(row); }}),
			dt_column('xtype'),
			dt_column('severity', {'render': function (data, type, row, meta) { return storage_pagepart_severity_label(row); }}),
			dt_column('refs', {'render': function (data, type, row, meta) { return storage_pagepart_vuln_refs(row); }}),
			dt_column('tags'),
			dt_column('comment'),
			dt_column_buttons(storage_pagepart_vuln_controls)
		],
		'select': {'style': 'multi', 'selector': 'td:first-child'}
	};
	$(document).ready(function() {
		var dt_vuln_list_table = $('#vuln_list_table').DataTable($.extend({}, dt_ajax_options, dt_vuln_list_table_options));
		$('#vuln_list_table_toolbar .abutton_selectall').on('click', {'dt': dt_vuln_list_table}, action_selectall);
		$('#vuln_list_table_toolbar .abutton_selectnone').on('click', {'dt': dt_vuln_list_table}, action_selectnone);
		$('#vuln_list_table_toolbar .abutton_tagmulti').on('click', {'dt': dt_vuln_list_table, 'url': "{{ url_for('storage.vuln_tag_by_id_route') }}"}, action_tag_by_id);
		$('#vuln_list_table_toolbar .abutton_deletemulti').on('click', {'dt': dt_vuln_list_table, 'url': "{{ url_for('storage.vuln_delete_by_id_route') }}"}, action_delete_by_id);
	});
</script>
{% endblock %}


{% block content %}
<div class="vulns">
	<h1>Vulns list</h1>

	<div id="vuln_list_table_toolbar" class="dt_toolbar">
		<button type="button" class="btn btn-xs btn-default abutton_selectall">All</button>
		<button type="button" class="btn btn-xs btn-default abutton_selectnone">None</button>
		<button type="button" class="btn btn-xs btn-default abutton_tagmulti" data-tag="info"><span class="glyphicon glyphicon-tag"></span> Info</button>
		<button type="button" class="btn btn-xs btn-default abutton_tagmulti" data-tag="report"><span class="glyphicon glyphicon-tag"></span> Report</button>
		<button type="button" class="btn btn-xs btn-default abutton_tagmulti" data-tag="todo"><span class="glyphicon glyphicon-tag"></span> TODO</button>
		<button type="button" class="btn btn-xs btn-default abutton_deletemulti"><span class="glyphicon glyphicon-trash text-alert"></span></button>
	</div>

	<table id="vuln_list_table" class="table table-hover table-responsive table-condensed"></table>
</div>
{% endblock %}
